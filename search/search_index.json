{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"SLurm batch queueing system","text":"<ul> <li>Slurm operations</li> <li>Slurm installation and upgrading</li> <li>Slurm configuration</li> </ul>"},{"location":"slurm_installation/","title":"Slurm installation and upgrading","text":""},{"location":"slurm_operations/","title":"Slurm operations","text":""},{"location":"zh/container/","title":"\u5bb9\u5668","text":"<p>\u5bb9\u5668\u662f\u4e00\u79cdLinux\u4e0a\u5e7f\u4e3a\u91c7\u7528\u7684\u5e94\u7528\u5c01\u88c5\u6280\u672f\uff0c\u5b83\u5c06\u53ef\u6267\u884c\u7a0b\u5e8f\u4e0e\u4f9d\u8d56\u5e93\u6253\u5305\u6210\u4e00\u4e2a\u955c\u50cf\u6587\u4ef6\uff0c\u542f\u52a8\u65f6\u4e0e\u5bbf\u4e3b\u8282\u70b9\u5171\u4eab\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u3002 \u7531\u4e8e\u955c\u50cf\u6587\u4ef6\u540c\u65f6\u643a\u5e26\u53ef\u6267\u884c\u6587\u4ef6\u548c\u4f9d\u8d56\u5e93\uff0c\u907f\u514d\u4e86\u4e24\u8005\u4e0d\u5339\u914d\u9020\u6210\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u8fd8\u80fd\u5728\u4e00\u4e2a\u5bbf\u4e3bLinux\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u652f\u6301\u591a\u79cd\u4e0d\u540c\u7684Linux\u53d1\u884c\u7248\uff0c\u8b6c\u5982\u5728CentOS\u53d1\u884c\u7248\u4e0a\u8fd0\u884cUbuntu\u7684 apt-get \u547d\u4ee4\u3002</p> <p>\u8d85\u7b97\u96c6\u7fa4\u91c7\u7528\u57fa\u4e8e Singularity \u7684\u9ad8\u6027\u80fd\u8ba1\u7b97\u5bb9\u5668\u6280\u672f\uff0c\u76f8\u6bd4Docker\u7b49\u5728\u4e91\u8ba1\u7b97\u73af\u5883\u4e2d\u4f7f\u7528\u7684\u5bb9\u5668\u6280\u672f\uff0cSingularity \u540c\u65f6\u652f\u6301root\u7528\u6237\u548c\u975eroot\u7528\u6237\u542f\u52a8\uff0c\u4e14\u5bb9\u5668\u542f\u52a8\u524d\u540e\uff0c\u7528\u6237\u4e0a\u4e0b\u6587\u4fdd\u6301\u4e0d\u53d8\uff0c\u8fd9\u4f7f\u5f97\u7528\u6237\u6743\u9650\u5728\u5bb9\u5668\u5185\u90e8\u548c\u5916\u90e8\u90fd\u662f\u76f8\u540c\u7684\u3002 \u6b64\u5916\uff0cSingularity \u5f3a\u8c03\u5bb9\u5668\u670d\u52a1\u7684\u4fbf\u6377\u6027\u3001\u53ef\u79fb\u690d\u6027\u548c\u53ef\u6269\u5c55\u6027\uff0c\u800c\u5f31\u5316\u4e86\u5bb9\u5668\u8fdb\u7a0b\u7684\u9ad8\u5ea6\u9694\u79bb\u6027\uff0c\u56e0\u6b64\u91cf\u7ea7\u66f4\u8f7b\uff0c\u5185\u6838namespace\u66f4\u5c11\uff0c\u6027\u80fd\u635f\u5931\u66f4\u5c0f\u3002</p>"},{"location":"zh/example/","title":"Example","text":""},{"location":"zh/example/#alphafold","title":"AlphaFold","text":"<pre><code>module load anaconda/python3.8/2020.07 alphafold\n</code></pre> <pre><code>#!/bin/bash \n#SBATCH -J alphafold_example\n#SBATCH -p dl\n#SBATCH --nodes=1\n#SBATCH --ntasks-per-node=1\n#SBATCH --cpus-per-task=24\n#SBATCH --gpus-per-node v100:1\n#SBATCH --time=04:00:00\n#SBATCH -A slurm-account-name\nmodule load anaconda/python3.8/2020.07\nmodule load alphafold\n\nexport TF_FORCE_UNIFIED_MEMORY='1'\nexport XLA_PYTHON_CLIENT_MEM_FRACTION='4.0'\npython /N/soft/rhel7/alphafold/alphafold/run_alphafold.py \\\n--fasta_paths=T1050.fasta \\\n--output_dir= /N/slate/$USER \\\n--model_names=model_1,model_2,model_3,model_4,model_5 \\\n--max_template_date=2020-05-14 \\\n--preset=full_dbs \\\n--benchmark=False \\\n--logtostderr \\\n--flagfile=alphafold_flags\n</code></pre>"},{"location":"zh/jobs/","title":"\u4f5c\u4e1a","text":""},{"location":"zh/jobs/#_2","title":"\u4f5c\u4e1a\u63d0\u4ea4\u6d41\u7a0b","text":"<ol> <li>\u7f16\u5199\u4f5c\u4e1a\u811a\u672c</li> </ol> <pre><code>vi test.slurm  # \u6839\u636e\u9700\u6c42\uff0c\u9009\u62e9\u8ba1\u7b97\u8d44\u6e90\uff1aCPU \u6216 GPU\u3001\u6240\u9700\u6838\u6570\u3001\u662f\u5426\u9700\u8981\u5927\u5185\u5b58\n</code></pre> <ol> <li>\u63d0\u4ea4\u4f5c\u4e1a</li> </ol> <pre><code>sbatch test.slurm\n</code></pre> <ol> <li>\u67e5\u770b\u4f5c\u4e1a\u548c\u8d44\u6e90</li> </ol> <pre><code>squeue       # \u67e5\u770b\u6b63\u5728\u6392\u961f\u6216\u8fd0\u884c\u7684\u4f5c\u4e1a\n</code></pre> <p>\u6216</p> <pre><code>sacct        # \u67e5\u770b\u8fc7\u53bb 24 \u5c0f\u65f6\u5185\u5df2\u5b8c\u6210\u7684\u4f5c\u4e1a\n</code></pre> <p>\u96c6\u7fa4\u8d44\u6e90\u5b9e\u65f6\u72b6\u6001\u67e5\u8be2</p> <pre><code>sinfo        # \u82e5\u6709 idle \u6216 mix \u72b6\u6001\u7684\u8282\u70b9\uff0c\u6392\u961f\u4f1a\u6bd4\u8f83\u5feb\n</code></pre>"},{"location":"zh/jobs/#_3","title":"\u96c6\u7fa4\u961f\u5217\u4ecb\u7ecd","text":"<p><code>scontrol show partition</code> \u67e5\u770b\u96c6\u7fa4\u961f\u5217\u4ecb\u7ecd <code>sinfo</code> \u67e5\u770b\u96c6\u7fa4\u8d44\u6e90\u5b9e\u65f6\u72b6\u6001</p>"},{"location":"zh/jobs/#job-array","title":"Job Array \u9635\u5217\u4f5c\u4e1a","text":"<p>\u4e00\u6279\u4f5c\u4e1a\uff0c\u82e5\u6240\u9700\u8d44\u6e90\u548c\u5185\u5bb9\u76f8\u4f3c\uff0c\u53ef\u501f\u52a9 Job Array \u6279\u91cf\u63d0\u4ea4\u3002Job Array \u4e2d\u7684\u6bcf\u4e00\u4e2a\u4f5c\u4e1a\u5728\u8c03\u5ea6\u65f6\u89c6\u4e3a\u72ec\u7acb\u7684\u4f5c\u4e1a\u3002</p> <p>cpu \u961f\u5217 slurm \u811a\u672c\u793a\u4f8b array</p> <pre><code>#!/bin/bash\n#SBATCH --job-name=test           # \u4f5c\u4e1a\u540d\n#SBATCH --partition=small         # small \u961f\u5217\n#SBATCH -n 1                      # \u603b\u6838\u6570 1\n#SBATCH --ntasks-per-node=1       # \u6bcf\u8282\u70b9\u6838\u6570\n#SBATCH --output=array_%A_%a.out\n#SBATCH --output=array_%A_%a.err\n#SBATCH --array=1-20%10           # \u603b\u5171 20 \u4e2a\u5b50\u4efb\u52a1\uff0c\u6bcf\u6b21\u6700\u591a\u540c\u65f6\u8fd0\u884c 10 \u4e2a\necho $SLURM_ARRAY_TASK_ID\n</code></pre>"},{"location":"zh/jobs/#_4","title":"\u4f5c\u4e1a\u4f9d\u8d56\u5173\u8054","text":"<p>\u63d0\u4ea4\u4f5c\u4e1a\u65f6\u53ef\u4ee5\u6307\u5b9a\u4f5c\u4e1a\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u901a\u8fc7\u5404\u79cd\u903b\u8f91\u5173\u7cfb\u7684\u8bbe\u7f6e\u6765\u5b8c\u6210\u4e00\u4e2a\u590d\u6742\u7684\u4e1a\u52a1\u5904\u7406\u6d41\u7a0b\u3002 \u5e38\u7528\u7684\u903b\u8f91\u5173\u7cfb\u5305\u62ec\uff1a <code>after</code>\uff08\u4f9d\u8d56\u4f5c\u4e1a\u5f00\u59cb\u8fd0\u884c\u65f6\uff09 <code>afterok</code>\uff08\u4f9d\u8d56\u4f5c\u4e1a\u6b63\u5e38\u7ed3\u675f\u65f6\uff09 <code>afterany</code>\uff08\u4f9d\u8d56\u4f5c\u4e1a\u5747\u5b8c\u6210\uff09 <code>afternotok</code>\uff08\u4f9d\u8d56\u4f5c\u4e1a\u975e\u6b63\u5e38\u7ed3\u675f\uff09</p> <p>\u4e00\u4e2a\u6d41\u6c34\u7ebf\u5e94\u8be5\u5305\u62ec\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>\u51c6\u5907\u9636\u6bb5\uff1ajob_prep.sh</li> <li>\u4e24\u4e2a\u5de5\u4f5c\u4efb\u52a1\uff08job01.sh \u548c job02.sh\uff09</li> <li>\u5982\u679c\u6210\u529f\uff1a\u4e00\u4e2a\u6536\u96c6\u4efb\u52a1\uff08job_coll.sh\uff09</li> <li>\u5426\u5219\uff1a\u4e00\u4e2a\u5904\u7406\u9519\u8bef\u7684\u4efb\u52a1\uff08job_handle_err.sh\uff09</li> </ul> <p>\u4e0b\u9762\u7684\u811a\u672c\u5c06\u6839\u636e\u5b83\u4eec\u7684\u4f9d\u8d56\u5173\u7cfb\u63d0\u4ea4\u8fd9\u4e09\u4e2a\u4efb\u52a1\u3002</p> <pre><code>jid_pre=$(sbatch --parsable job_prep.sh)\njid_w01=$(sbatch --parsable --dependency=afterok:${jid_pre} job01.sh)\njid_w02=$(sbatch --parsable --dependency=afterok:${jid_pre} job02.sh)\nsbatch --dependency=afterok:${jid_w01}:${jid_w02} job_coll.sh\nsbatch --dependency=afternotok:${jid_w01}:${jid_w02} job_handle_err.sh\n</code></pre>"},{"location":"zh/module/","title":"\u8f6f\u4ef6\u6a21\u5757","text":""},{"location":"zh/module/#module","title":"module \u547d\u4ee4","text":"<p>\u96c6\u7fa4\u8f6f\u4ef6\u4ee5 <code>module</code> \u5f62\u5f0f\u4f9b\u5168\u5c40\u8c03\u7528\u3002\u5e38\u89c1\u7684 <code>module</code> \u547d\u4ee4\u5982\u4e0b</p> module \u529f\u80fd <code>module load [MODULE]</code> \u52a0\u8f7d\u6a21\u5757 <code>module avail</code> \u6216 <code>module av</code> \u5217\u51fa\u6240\u6709\u6a21\u5757 <code>module list</code> \u5217\u51fa\u6240\u6709\u5df2\u52a0\u8f7d\u7684\u6a21\u5757 <code>module show [MODULE]</code> \u5217\u51fa\u8be5\u6a21\u5757\u7684\u4fe1\u606f\uff0c\u5982\u8def\u5f84\u3001\u73af\u5883\u53d8\u91cf\u7b49"},{"location":"zh/slurm_installation/","title":"Slurm \u5b89\u88c5\u548c\u5347\u7ea7","text":""},{"location":"zh/slurm_installation/#slurmctld","title":"slurmctld \u4e3b\u670d\u52a1\u5668\u7684\u786c\u4ef6\u4f18\u5316","text":"<p>SchedMD\u5efa\u8baeslurmctld\u670d\u52a1\u5668\u914d\u7f6e\u4e3a\u5177\u6709\u5c11\u91cf\u4f46\u9ad8\u6027\u80fd\u7684 CPU \u6838\u5fc3\uff0c\u4ee5\u786e\u4fdd\u6700\u4f73\u7684\u54cd\u5e94\u80fd\u529b\u3002</p> <p>\u6587\u4ef6\u7cfb\u7edf<code>/var/spool/slurmctld/</code>\u5e94\u5b89\u88c5\u5728\u5c3d\u53ef\u80fd\u5feb\u7684\u78c1\u76d8\u4e0a\uff08\u5982SSD\u6216NVMe\uff09\u3002</p>"},{"location":"zh/slurm_installation/#_1","title":"\u521b\u5efa\u5168\u5c40\u7528\u6237\u8d26\u6237","text":"<p>\u6574\u4e2a\u96c6\u7fa4\u5fc5\u987b\u5177\u6709\u7edf\u4e00\u7684\u7528\u6237\u548c\u7ec4\u547d\u540d\u7a7a\u95f4\uff08\u5305\u62ecUIDs\u548cGIDs\uff09\uff0c\u8bf7\u53c2\u8003Slurm Quick Start\u7ba1\u7406\u5458\u6307\u5357\u3002\u867d\u7136\u65e0\u9700\u5141\u8bb8\u7528\u6237\u767b\u5f55\u5230\u63a7\u5236\u4e3b\u673a\uff08ControlMachine\u6216BackupController\uff09\uff0c\u4f46\u5fc5\u987b\u5728\u8fd9\u4e9b\u4e3b\u673a\u4e0a\u914d\u7f6e\u7528\u6237\u548c\u7ec4\u3002\u82e5\u8981\u9650\u5236\u7528\u6237\u901a\u8fc7 SSH \u767b\u5f55\uff0c\u8bf7\u4f7f\u7528 <code>/etc/ssh/sshd_config</code> \u4e2d\u7684 <code>AllowUsers</code> \u53c2\u6570\u3002</p> <p>Slurm\u548cMUNGE\u9700\u8981\u5728\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u670d\u52a1\u5668\u548c\u8282\u70b9\u4e0a\u4fdd\u6301\u4e00\u81f4\u7684UIDs\u548cGIDs\uff0c\u5305\u62ecslurm\u548cmunge\u7528\u6237\u3002</p> <p>\u91cd\u8981\u63d0\u793a\uff1a\u907f\u514d\u4f7f\u7528\u4f4e\u4e8e 1000 \u7684 UID \u548c GID\u3002\u8fd9\u5728\u6807\u51c6\u914d\u7f6e\u6587\u4ef6<code>/etc/login.defs</code>\u4e2d\u7531<code>UID_MIN\u3001UID_MAX\u3001GID_MIN\u3001GID_MAX</code>\u7b49\u53c2\u6570\u5b9a\u4e49\uff0c\u8be6\u60c5\u8bf7\u53c2\u9605https://en.wikipedia.org/wiki/User_identifier\u3002</p> <p>\u521b\u5efa\u7528\u4e8e Slurm \u548c MUNGE \u7684\u7528\u6237\u548c\u7ec4\uff0c\u4f8b\u5982\uff1a</p> <pre><code>export MUNGEUSER=1005\ngroupadd -g $MUNGEUSER munge\nuseradd  -m -c \"MUNGE Uid 'N' Gid Emporium\" -d /var/lib/munge -u $MUNGEUSER -g munge  -s /sbin/nologin munge\nexport SlurmUSER=1001\ngroupadd -g $SlurmUSER slurm\nuseradd  -m -c \"Slurm workload manager\" -d /var/lib/slurm -u $SlurmUSER </code></pre> <p>\u8bf7\u786e\u4fdd\u5728\u6240\u6709\u8282\u70b9\u4e0a\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u521b\u5efa\u8fd9\u4e9b\u7528\u6237\u3002\u8fd9\u5fc5\u987b\u5728\u5b89\u88c5 RPM \u5305\u4e4b\u524d\u5b8c\u6210\uff08\u5982\u679c\u8fd9\u4e9b\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u521b\u5efa\u968f\u673a\u7684 UID/GID \u5bf9\uff09\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0cUID \u548c GID \u57281000\u4ee5\u4e0b\u76ee\u524d\u4fdd\u7559\u7ed9 CentOS \u7cfb\u7edf\u7528\u6237\uff0c\u8bf7\u53c2\u8003\u672c\u6587\u548c\u6587\u4ef6 <code>/etc/login.defs</code>\u3002</p>"},{"location":"zh/system/","title":"\u7cfb\u7edf","text":""},{"location":"zh/system/#_2","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>\u8d44\u6e90</p> <ul> <li>\u4f5c\u4e1a\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u53ef\u91cf\u5316\u5b9e\u4f53\u90fd\u662f\u8d44\u6e90</li> <li>\u5305\u62ec\u786c\u4ef6\u8d44\u6e90\uff08\u8282\u70b9\u3001\u5185\u5b58\u3001CPU \u3001GPU\u7b49\uff09\u548c\u8f6f\u4ef6\u8d44\u6e90\uff08 License \uff09</li> </ul> <p>\u96c6\u7fa4</p> <ul> <li>\u5305\u542b\u8ba1\u7b97\u3001\u5b58\u50a8\u3001\u7f51\u7edc\u7b49\u5404\u79cd\u8d44\u6e90\u5b9e\u4f53\u4e14\u5f7c\u6b64\u8054\u7cfb\u7684\u8d44\u6e90\u96c6\u5408\uff1b</li> <li>\u5728\u7269\u7406\u4e0a\uff0c\u4e00\u822c\u7531\u8ba1\u7b97\u5904\u7406\u3001\u4e92\u8054\u901a\u4fe1\u3001I/O \u5b58\u50a8\u3001\u64cd\u4f5c\u7cfb\u7edf\u3001\u7f16\u8bd1\u5668\u3001 \u8fd0\u884c\u73af\u5883\u3001\u5f00\u53d1\u5de5\u5177\u7b49\u591a\u4e2a\u8f6f\u786c\u4ef6\u5b50\u7cfb\u7edf\u7ec4\u6210\uff1b</li> <li>\u8282\u70b9\u662f\u96c6\u7fa4\u7684\u57fa\u672c\u7ec4\u6210\u5355\u4f4d\uff0c\u4ece\u89d2\u8272\u4e0a\u4e00\u822c\u53ef\u4ee5\u5212\u5206\u4e3a\u7ba1\u7406\u8282\u70b9\u3001\u767b\u9646\u8282 \u70b9\u3001\u8ba1\u7b97\u8282\u70b9\u3001\u5b58\u50a8\u8282\u70b9\u7b49\u3002</li> </ul> <p>\u4f5c\u4e1a</p> <ul> <li>\u7269\u7406\u6784\u6210\uff0c\u4e00\u7ec4\u5173\u8054\u7684\u8d44\u6e90\u5206\u914d\u8bf7\u6c42\uff0c\u4ee5\u53ca\u4e00\u7ec4\u5173\u8054\u7684\u5904\u7406\u8fc7\u7a0b\uff1b</li> <li>\u4ea4\u4e92\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5206\u4e3a\u4ea4\u4e92\u5f0f\u4f5c\u4e1a\u548c\u975e\u4ea4\u4e92\u5f0f\u4f5c\u4e1a\uff1b</li> <li>\u8d44\u6e90\u4f7f\u7528\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e32\u884c\u4f5c\u4e1a\u548c\u5e76\u884c\u4f5c\u4e1a\uff1b</li> </ul> <p>\u5206\u533a</p> <ul> <li>\u5e26\u540d\u79f0\u7684\u4f5c\u4e1a\u5bb9\u5668\uff1b</li> <li>\u7528\u6237\u8bbf\u95ee\u63a7\u5236\uff1b</li> <li>\u8d44\u6e90\u4f7f\u7528\u9650\u5236\uff1b</li> </ul> <p>\u4f5c\u4e1a\u8c03\u5ea6\u7cfb\u7edf\uff08Job Schedule System\uff09</p> <ul> <li>\u8d1f\u8d23\u76d1\u63a7\u548c\u7ba1\u7406\u96c6\u7fa4\u4e2d\u8d44\u6e90\u548c\u4f5c\u4e1a\u7684\u8f6f\u4ef6\u7cfb\u7edf\uff1b</li> <li>\u901a\u5e38\u7531\u8d44\u6e90\u7ba1\u7406\u5668\u3001\u8c03\u5ea6\u5668\u3001\u4efb\u52a1\u6267\u884c\u5668\uff0c\u4ee5\u53ca\u7528\u6237\u547d\u4ee4\u548cAPI\u7ec4\u6210\uff1b</li> </ul>"},{"location":"zh/system/#hpc","title":"HPC\u96c6\u7fa4","text":"<p>\u4e00\u4e2a\u5927\u89c4\u6a21\u7684\u8d85\u7b97\uff0c\u6309\u7167\u4f20\u7edf\u7684 HPC style\uff0c\u6839\u636e\u529f\u80fd\u4e0d\u540c\uff0c\u5927\u6982\u7c97\u7565\u5206\u4e3a\u51e0\u79cd\u4e0d\u540c\u7684\u8282\u70b9\u3002</p> <ul> <li> <p>\u767b\u9646\u8282\u70b9</p> <p>\u548c\u666e\u901a\u7528\u6237\u4ea4\u4e92\u7684\u4e3b\u8981\u8282\u70b9\u3002\u4e3b\u8981\u7528\u6765\u63a5\u53d7\u7528\u6237\u7684 ssh \u8fde\u63a5\u548c\u6587\u4ef6\u4f20\u9001\uff0c\u540c\u65f6\u53ef\u4ee5\u7528\u6765\u7f16\u8bd1\u7a0b\u5e8f\uff0c\u4fee\u6539\u4ee3\u7801\u548c\u901a\u8fc7\u4efb\u52a1\u7ba1\u7406\u7cfb\u7edf\u63d0\u4ea4\u4efb\u52a1\u5230\u8ba1\u7b97\u8282\u70b9\u3002\u767b\u9646\u8282\u70b9\u8fd8\u53ef\u7ec6\u5206\u4e3a\u6700\u5916\u4fa7\u7684\u8d1f\u8d23 VPN \u5bf9\u63a5\u5916\u7f51\u548c\u5165\u6d41\u91cf\u5206\u6d41\u8d1f\u8f7d\u5747\u8861\u7684\u8282\u70b9\uff0c\u4ee5\u53ca\u666e\u901a\u7684\u7528\u6765\u6d4f\u89c8\u6587\u4ef6\u7f16\u8bd1\u7a0b\u5e8f\u63d0\u4ea4\u4efb\u52a1\u7684\u8282\u70b9\uff0c\u548c\u8d1f\u8d23\u9ad8\u5e26\u5bbd\u5927\u6587\u4ef6\u4f20\u8f93\u7684\u4e13\u7528\u8282\u70b9\u7b49\u3002</p> </li> <li> <p>\u63a7\u5236\u8282\u70b9</p> <p>\u666e\u901a\u7528\u6237\u65e0\u6cd5\u767b\u9646\uff0c\u4e00\u822c\u5177\u6709\u5355\u72ec\u7684\u7ba1\u7406\u7f51\u7edc\uff0c\u7528\u4e8e\u7ba1\u7406\u8f6f\u4ef6\u90e8\u7f72\u7684\u8282\u70b9\u3002\u8fd8\u53ef\u7ec6\u5206\u4e3a\u63d0\u4f9b\u8d44\u6e90\u7ba1\u7406\u8f6f\u4ef6\uff0c\u63d0\u4f9b\u8d26\u6237\u7ba1\u7406\u548c\u7f51\u7edc\u670d\u52a1\u7b49\u57fa\u7840\u8bbe\u65bd\uff0c\u63d0\u4f9b\u6570\u636e\u5e93\u540e\u7aef\uff0c\u63d0\u4f9b\u76d1\u63a7\u8f6f\u4ef6\u540e\u7aef\uff0c\u63d0\u4f9b\u5404\u79cd\u63a7\u5236\u9762\u677f\u524d\u7aef\u7b49\u4e0d\u540c\u529f\u80fd\u7684\u8282\u70b9\u3002\u5206\u7c7b\u8d8a\u7ec6\uff0c\u9ad8\u53ef\u7528\u5c31\u8d8a\u597d\u3002\u6bcf\u4e00\u79cd\u529f\u80fd\uff0c\u8fd8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5305\u62ec\u4e3b\u8282\u70b9\u548c\u5907\u7528\u4ece\u8282\u70b9\uff0c\u4ece\u800c\u9632\u6b62\u5355\u70b9\u6545\u969c\u3002</p> </li> <li> <p>\u5b58\u50a8\u8282\u70b9</p> <p>\u901a\u8fc7\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u5982 Lustre\uff0c\u5171\u4eab\u7ed9\u767b\u9646\u8282\u70b9\u548c\u8ba1\u7b97\u8282\u70b9\u4f7f\u7528\u3002\u901a\u5e38\u4e0e\u8fd9\u4e9b\u8282\u70b9\u901a\u8fc7\u9ad8\u901f\u4e92\u8054\u7f51\u7edc\uff0c\u6bd4\u5982 InfiniBand \u76f8\u8fde\u63a5\uff0c\u5e26\u7ed9\u7528\u6237\u8c03\u7528\u672c\u5730\u6587\u4ef6\u7684\u901f\u5ea6\u3002\u8fd8\u53ef\u7ec6\u5206\u4e3a\u5b58\u50a8\u5143\u6570\u636e\u7684\u8282\u70b9\uff0c\u5b58\u50a8\u6587\u4ef6\u5185\u5bb9\u7684\u8282\u70b9\uff0c\u5907\u4efd\u6570\u636e\u7684\u8282\u70b9\u7b49\u3002</p> </li> <li> <p>\u8ba1\u7b97\u8282\u70b9</p> <p>\u7528\u6765\u8fdb\u884c\u8ba1\u7b97\u4efb\u52a1\u7684\u8282\u70b9\uff0c\u5360\u636e\u4e86\u8d85\u7b97\u8282\u70b9\u4e2d\u7684\u7edd\u5927\u591a\u6570\u3002\u8fd8\u53ef\u7ec6\u5206\u4e3a\u4e0d\u540c\u786c\u4ef6\u7279\u6027\u7684\u8ba1\u7b97\u8282\u70b9\u3002\u6bd4\u5982\u5927\u5185\u5b58\u8282\u70b9\u7528\u6765\u89e3\u51b3\u5185\u5b58\u74f6\u9888\u7684\u95ee\u9898\uff0c\u73b0\u5728\u6700\u5927\u5185\u5b58\u53ef\u8fbe S3T\u3002\u53c8\u6bd4\u5982\u591a GPU \u8282\u70b9\uff0c\u7528\u6765\u8fdb\u884c\u673a\u5668\u5b66\u4e60\u7b49\u4efb\u52a1\u3002\u8fd8\u6709\u5177\u6709\u672c\u5730\u56fa\u6001\u786c\u76d8\u7684\u8282\u70b9\uff0c\u7528\u6765\u6ee1\u8db3\u9700\u8981\u9ad8\u901f IO \u7684\u8ba1\u7b97\u4efb\u52a1\u7684\u9700\u6c42\u7b49\u7b49\u3002</p> </li> </ul> <p>\u5bf9\u4e8e\u5c0f\u578b\u7684 HPC \u96c6\u7fa4\uff0c\u5f88\u591a\u65f6\u5019\u5f80\u5f80\u767b\u9646\u8282\u70b9\uff0c\u63a7\u5236\u8282\u70b9\u548c\u5b58\u50a8\u8282\u70b9\u7684\u89d2\u8272\uff0c\u90fd\u7531\u540c\u4e00\u53f0\u673a\u5668\u62c5\u4efb\uff0c\u540c\u65f6\u6574\u4e2a\u7cfb\u7edf\u4e5f\u5f80\u5f80\u53ea\u5177\u6709\u4e00\u5957\u7f51\u7edc\u3002</p> <p> </p> System <p> </p> Example Hardware"},{"location":"zh/system/#nvidia-dgx-superpod","title":"NVIDIA DGX SuperPOD","text":"Example deployment with depolyed software on each respective host System"},{"location":"zh/system/#deepops","title":"DeepOps","text":"From a shiny new DGX POD <ul> <li>\u8fd9\u4e2a\u5f00\u6e90\u9879\u76ee\u65e8\u5728\u7b80\u5316\u5728\u672c\u5730\u3001\u53ef\u9009\u62e9\u79bb\u7ebf\u6570\u636e\u4e2d\u5fc3\u6216\u4e91\u73af\u5883\u4e2d\u90e8\u7f72\u591a\u8282\u70b9 GPU \u96c6\u7fa4\u7684\u6df1\u5ea6\u5b66\u4e60\u548c\u9ad8\u6027\u80fd\u8ba1\u7b97\u73af\u5883\u3002</li> <li>DeepOps \u4e5f\u88ab\u8ba4\u53ef\u4e3a DGX POD \u7ba1\u7406\u8f6f\u4ef6\u3002</li> <li>\u8be5\u9879\u76ee\u7684\u6a21\u5757\u5316\u6027\u8d28\u8fd8\u5141\u8bb8\u7ecf\u9a8c\u4e30\u5bcc\u7684\u7ba1\u7406\u5458\u6311\u9009\u548c\u9009\u62e9\u53ef\u80fd\u6709\u7528\u7684\u7ec4\u4ef6\uff0c\u4f7f\u5f97\u8be5\u8fc7\u7a0b\u4e0e\u4ed6\u4eec\u73b0\u6709\u7684\u8f6f\u4ef6\u6216\u57fa\u7840\u67b6\u6784\u517c\u5bb9\u3002</li> </ul> DGX POD Management Software DeepOps Components <p>GPU Compute node(s):</p> <ul> <li>For high-performance compute workloads</li> </ul> <p>Management node(s):</p> <ul> <li>Used for cluster management</li> </ul> <p>Provisioning node:</p> <ul> <li>Orchestrates the initial setup of the cluster</li> </ul>"},{"location":"zh/system/#architecture","title":"Architecture","text":"Building Multi-node GPU Clusters with DeepOps <ul> <li>1x CPU-only login node</li> <li> <p>Odd number of CPU-only management nodes</p> <ul> <li>required for etcd key-value store</li> </ul> </li> <li> <p>1/10Gb Ethernet control &amp; management networks</p> <ul> <li>Management, connectivity, command &amp; control</li> </ul> </li> <li> <p>Fully non-blocking fat-tree 100Gb EDR Infiniband topology</p> <ul> <li>Use the biggest EDR IB core switch that fits</li> </ul> </li> </ul>"},{"location":"zh/system/#scheduler","title":"Scheduler","text":"<p>\u8c03\u5ea6\u7cfb\u7edf\u662f\u9762\u5411\u96c6\u7fa4\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <ul> <li>\u5355\u4e00\u7cfb\u7edf\u6620\u50cf<ul> <li>\u89e3\u51b3\u96c6\u7fa4\u7ed3\u6784\u677e\u6563\u95ee\u9898\uff1b</li> <li>\u7edf\u4e00\u7528\u6237\u63a5\u53e3\uff0c\u4f7f\u7528\u7b80\u5316\uff1b</li> </ul> </li> <li>\u7cfb\u7edf\u8d44\u6e90\u6574\u5408<ul> <li>\u7ba1\u7406\u5f02\u6784\u8d44\u6e90\u548c\u5f02\u6784\u7cfb\u7edf\uff1b</li> </ul> </li> <li>\u591a\u4efb\u52a1\u7ba1\u7406<ul> <li>\u7edf\u4e00\u7ba1\u7406\u4efb\u52a1\uff0c\u907f\u514d\u51b2\u7a81\uff1b</li> </ul> </li> <li>\u8d44\u6e90\u8bbf\u95ee\u63a7\u5236<ul> <li>\u57fa\u4e8e\u7b56\u7565\u7684\u8d44\u6e90\u8bbf\u95ee\u63a7\u5236\uff1b</li> </ul> </li> </ul> Kubernetes SLURM Basic scheduling features Advanced scheduling features Share nodes, schedule jobs for GPUs on a node(current best solution: Excel spreadsheet) Multi-node jobsJob dependencies, workflows, DAGsAdvanced reservationsIntelligent scheduling (not just FIFO) Covers data permissions and security(LDAP, file permissions) Other HPC-like scheduling functionality Adds analytics and monitoring(important also for justification of purchase) ..."},{"location":"zh/system/#kubernetes","title":"Kubernetes","text":"<ul> <li> Prepare Provisioning Node</li> <li> Prepare Management Nodes</li> <li> Kubernetes Management Nodes</li> <li> Basic Cluster Services</li> <li> Provision Compute Nodes</li> <li> AAdditional Cluster Services </li> <li> Kubernetes on Compute Nodes</li> <li> Deploy Kubeflow</li> </ul> <p>\u63d0\u4ea4\u4e00\u4e2a GPU-enabled \u4f5c\u4e1a\u5230GPU\u8ba1\u7b97\u8282\u70b9</p> <pre><code>apiVersion: kubeflow.org/v1alpha2\nkind: MPIJob\nmetadata:\nname: tensorflow-mpi-job\nspec:\nslotsPerWorker: 1\nmpiReplicaSpecs:\nLauncher:\nreplicas: 1\ntemplate:\nspec:\ncontainers:\n- image: \"nvcr.io/nvidia/tensorflow:21.03-tf1-py3\"\nname: tensorflow-mpi-job-container\ncommand:\n- mpirun\n- -np\n- \"4\"\n- -bind-to\n- none\n- -map-by\n- slot\n- -x\n- NCCL_DEBUG=INFO\n- -x\n- LD_LIBRARY_PATH\n- -x\n- PATH\n- -mca\n- pml\n- ob1\n- -mca\n- btl\n- ^openib\n- --allow-run-as-root\n- python\n- /workspace/nvidia-examples/cnn/resnet.py\n- --layers\n- \"50\"\n- --batch_size\n- \"512\"\nWorker:\n# The number of workers (M)\nreplicas: 4\ntemplate:\nspec:\ncontainers:\n- image: \"nvcr.io/nvidia/tensorflow:21.03-tf1-py3\"\nname: tensorflow-mpi-job-container\nresources:\nlimits:\n# The number of GPUs per-worker (N)\nnvidia.com/gpu: 1\n</code></pre>"},{"location":"zh/system/#slurm","title":"Slurm","text":"Slurm components <p>SLURM \uff08Simple Linux Utility for Resource Management\uff09\u662f\u4e00\u79cd\u53ef\u6269\u5c55\u7684\u5de5\u4f5c\u8d1f\u8f7d\u7ba1\u7406\u5668\uff0c\u5df2\u88ab\u5168\u4e16\u754c\u7684\u56fd\u5bb6\u8d85\u7ea7\u8ba1\u7b97\u673a\u4e2d\u5fc3\u5e7f\u6cdb\u91c7\u7528\u3002 \u5b83\u662f\u514d\u8d39\u4e14\u5f00\u6e90\u7684\uff0c\u6839\u636eGPL\u901a\u7528\u516c\u5171\u8bb8\u53ef\u8bc1\u53d1\u884c\u3002</p>"},{"location":"zh/system/#slurm_1","title":"Slurm \u6982\u89c8","text":"Slurm \u529f\u80fd sinfo \u96c6\u7fa4\u72b6\u6001 squeue \u6392\u961f\u4f5c\u4e1a\u72b6\u6001 sbatch \u4f5c\u4e1a\u63d0\u4ea4 scontrol \u67e5\u770b\u548c\u4fee\u6539\u4f5c\u4e1a\u53c2\u6570 sacct \u5df2\u5b8c\u6210\u4f5c\u4e1a\u62a5\u544a scancel \u5220\u9664\u4f5c\u4e1a"},{"location":"zh/system/#sinfo","title":"<code>sinfo</code> \u67e5\u770b\u96c6\u7fa4\u72b6\u6001","text":"Slurm \u529f\u80fd <code>sinfo -N</code> \u67e5\u770b\u8282\u70b9\u7ea7\u4fe1\u606f <code>sinfo -N --states=idle</code> \u67e5\u770b\u53ef\u7528\u8282\u70b9\u4fe1\u606f <code>sinfo --partition=cpu</code> \u67e5\u770b\u961f\u5217\u4fe1\u606f <code>sinfo --help</code> \u67e5\u770b\u6240\u6709\u9009\u9879 <p>\u8282\u70b9\u72b6\u6001\u5305\u62ec\uff1a <code>drain</code> (\u8282\u70b9\u6545\u969c)\uff0c<code>alloc</code>(\u8282\u70b9\u5728\u7528)\uff0c<code>idle</code>(\u8282\u70b9\u53ef\u7528)\uff0c<code>down</code>(\u8282\u70b9\u4e0b\u7ebf)\uff0c<code>mix</code> (\u8282\u70b9\u90e8\u5206\u5360\u7528\uff0c\u4f46\u4ecd\u6709\u5269\u4f59\u8d44\u6e90\uff09\u3002</p>"},{"location":"zh/system/#squeue","title":"<code>squeue</code>\u67e5\u770b\u4f5c\u4e1a\u4fe1\u606f","text":"Slurm \u529f\u80fd <code>squeue -j jobid</code> \u67e5\u770b\u4f5c\u4e1a\u4fe1\u606f <code>squeue -l</code> \u67e5\u770b\u7ec6\u8282\u4fe1\u606f <code>squeue -n HOST</code> \u67e5\u770b\u7279\u5b9a\u8282\u70b9\u4f5c\u4e1a\u4fe1\u606f <code>squeue</code> \u67e5\u770bUSER_LIST\u7684\u4f5c\u4e1a <code>squeue --state=R</code> \u67e5\u770b\u7279\u5b9a\u72b6\u6001\u7684\u4f5c\u4e1a <code>squeue --help</code> \u67e5\u770b\u6240\u6709\u7684\u9009\u9879 <code>squeue -u &lt;username&gt;</code> \u5217\u51fa\u7528\u6237\u7684\u6240\u6709\u5f53\u524d\u4f5c\u4e1a <p>\u4f5c\u4e1a\u72b6\u6001\u5305\u62ec<code>R</code>(\u6b63\u5728\u8fd0\u884c)\uff0c<code>PD</code>(\u6b63\u5728\u6392\u961f)\uff0c<code>CG</code>(\u5373\u5c06\u5b8c\u6210)\uff0c<code>CD</code>(\u5df2\u5b8c\u6210)\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0csqueue\u53ea\u4f1a\u5c55\u793a\u5728\u6392\u961f\u6216\u5728\u8fd0\u884c\u7684\u4f5c\u4e1a\u3002 <pre><code>$ squeue\nJOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)\n18046      dgx2   ZXLing     eenl  R    1:35:53      1 vol04\n17796      dgx2   python    eexdl  R 3-00:22:04      1 vol02\n</code></pre></p>"},{"location":"zh/system/#sbatch","title":"<code>sbatch</code>\u4f5c\u4e1a\u63d0\u4ea4","text":"<p>\u51c6\u5907\u4f5c\u4e1a\u811a\u672c\u7136\u540e\u901a\u8fc7sbatch\u63d0\u4ea4\u662f Slurm \u7684\u6700\u5e38\u89c1\u7528\u6cd5\u3002 \u4e3a\u4e86\u5c06\u4f5c\u4e1a\u811a\u672c\u63d0\u4ea4\u7ed9\u4f5c\u4e1a\u7cfb\u7edf\uff0cSlurm \u4f7f\u7528</p> <pre><code>$ sbatch jobscript.slurm\n</code></pre> <p>Slurm \u5177\u6709\u4e30\u5bcc\u7684\u53c2\u6570\u96c6\u3002 \u4ee5\u4e0b\u6700\u5e38\u7528\u7684\u3002</p> Slurm \u542b\u4e49 <code>-n [count]</code> \u603b\u8fdb\u7a0b\u6570 <code>--ntasks-per-node=[count]</code> \u6bcf\u53f0\u8282\u70b9\u4e0a\u7684\u8fdb\u7a0b\u6570 <code>-p [partition]</code> \u4f5c\u4e1a\u961f\u5217 <code>--job-name=[name]</code> \u4f5c\u4e1a\u540d <code>--output=[file_name]</code> \u6807\u51c6\u8f93\u51fa\u6587\u4ef6 <code>--error=[file_name]</code> \u6807\u51c6\u9519\u8bef\u6587\u4ef6 <code>--time=[dd-hh:mm:ss]</code> \u4f5c\u4e1a\u6700\u5927\u8fd0\u884c\u65f6\u957f <code>--exclusive</code> \u72ec\u5360\u8282\u70b9 <code>--mail-type=[type]</code> \u901a\u77e5\u7c7b\u578b\uff0c\u53ef\u9009 all, fail, end\uff0c\u5206\u522b\u5bf9\u5e94\u5168\u901a\u77e5\u3001\u6545\u969c\u901a\u77e5\u3001\u7ed3\u675f\u901a\u77e5 <code>--mail-user=[mail_address]</code> \u901a\u77e5\u90ae\u7bb1 <code>--nodelist=[nodes]</code> \u504f\u597d\u7684\u4f5c\u4e1a\u8282\u70b9 <code>--exclude=[nodes]</code> \u907f\u514d\u7684\u4f5c\u4e1a\u8282\u70b9 <code>--depend=[state:job_id]</code> \u4f5c\u4e1a\u4f9d\u8d56 <code>--array=[array_spec]</code> \u5e8f\u5217\u4f5c\u4e1a <p>\u6279\u5904\u7406\u4f5c\u4e1a\u811a\u672c\u7531\u56db\u4e2a\u4e3b\u8981\u7ec4\u6210\u90e8\u5206\u7ec4\u6210\uff1a</p> <ul> <li>\u7528\u4e8e\u6267\u884c\u811a\u672c\u7684\u89e3\u91ca\u5668</li> <li>\"# \"\u6307\u4ee4\uff0c\u7528\u4e8e\u4f20\u9012\u9ed8\u8ba4\u63d0\u4ea4\u9009\u9879\u3002</li> <li>\u8bbe\u7f6e\u73af\u5883\u548c/\u6216\u811a\u672c\u53d8\u91cf\uff08\u5982\u679c\u9700\u8981\u7684\u8bdd\uff09</li> <li>\u8981\u6267\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee5\u53ca\u5176\u8f93\u5165\u53c2\u6570\u548c\u9009\u9879</li> </ul> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\u4f5c\u4e1a\u811a\u672c\uff0c\u5b83\u5728\u201cscience\u201d\u8ba1\u8d39\u8d26\u6237\u4e0b\u5411cpu\u961f\u5217\u8bf7\u6c428\u4e2a\u8282\u70b9\uff0c\u5e76\u5728\u5206\u914d\u76848\u4e2a\u8282\u70b9\u4e0a\u542f\u52a832\u4e2amyApp\u4efb\u52a1\uff0c\u5e76\u5728\u4f5c\u4e1a\u5b8c\u6210\u65f6\u901a\u77e5\uff1a</p> <pre><code>#!/bin/bash\n#SBATCH -A science\n#SBATCH --partition=cpu\n#SBATCH -N 8 # \u7533\u8bf7\u8282\u70b9\u6570\u4e3a8,\u5982\u679c\u4f5c\u4e1a\u4e0d\u80fd\u8de8\u8282\u70b9(MPI)\u8fd0\u884c, \u7533\u8bf7\u7684\u8282\u70b9\u6570\u5e94\u4e0d\u8d85\u8fc71;\n#SBATCH -n 32\n#SBATCH --mail-type=end\n#SBATCH --mail-user=YOU@EMAIL.COM\n#SBATCH --output=%j.out # \u811a\u672c\u6267\u884c\u7684\u8f93\u51fa\u5c06\u88ab\u4fdd\u5b58\u5728\u5f53%j.out\u6587\u4ef6\u4e0b\uff0c%j\u8868\u793a\u4f5c\u4e1a\u53f7;\n#SBATCH --error=%j.err \n#SBATCH --qos=low # \u6307\u5b9a\u4f5c\u4e1a\u7684QOS\u4e3alow;\n#SBATCH -J myFirstJob   # \u4f5c\u4e1a\u5728\u8c03\u5ea6\u7cfb\u7edf\u4e2d\u7684\u4f5c\u4e1a\u540d\u4e3amyFirstJob;\n# Set environment variables if necessary\n# Execute the application\nmyApp [arguments and options]\n</code></pre> <p>\u5047\u8bbe\u4e0a\u9762\u4f5c\u4e1a\u811a\u672c\u7684\u6587\u4ef6\u540d\u4e3a<code>job.sh</code>\uff0c\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u63d0\u4ea4\uff1a</p> <pre><code>sbatch job.sh\n</code></pre> <p><code>squeue</code>\u53ef\u7528\u4e8e\u68c0\u67e5\u4f5c\u4e1a\u72b6\u6001\u3002\u7528\u6237\u53ef\u4ee5\u5728\u4f5c\u4e1a\u6267\u884c\u671f\u95f4\u901a\u8fc7SSH\u767b\u5f55\u5230\u8ba1\u7b97\u8282\u70b9\u3002\u8f93\u51fa\u5c06\u5b9e\u65f6\u66f4\u65b0\u5230\u6587\u4ef6<code>[jobid].out</code>\u548c<code>[jobid].err</code>\u3002</p> <p>\u8fd9\u91cc\u5c55\u793a\u4e00\u4e2a\u66f4\u590d\u6742\u7684\u4f5c\u4e1a\u8981\u6c42\uff0c\u5176\u4e2d\u5c06\u542f\u52a880\u4e2a\u8fdb\u7a0b\uff0c\u6bcf\u53f0\u4e3b\u673a40\u4e2a\u8fdb\u7a0b\u3002</p> <pre><code>#!/bin/bash\n#SBATCH --job-name=LINPACK\n#SBATCH --partition=cpu # \u4f5c\u4e1a\u63d0\u4ea4\u7684\u6307\u5b9a\u5206\u533a\u4e3acpu\n#SBATCH -n 80\n#SBATCH --ntasks-per-node=40 # \u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c40\u4e2a\u4efb\u52a1\uff0c--ntasks\u53c2\u6570\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e\u8be5\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e00\u60c5\u51b5\u4e0b\u4e5f\u53ef\u7406\u89e3\u4e3a\u6bcf\u4e2a\u8282\u70b9\u4f7f\u7528\u4e00\u4e2a\u6838\u5fc3\uff0c\u5982\u679c\u7a0b\u5e8f\u4e0d\u652f\u6301\u591a\u7ebf\u7a0b(\u5982openmp)\uff0c\u8fd9\u4e2a\u6570\u4e0d\u5e94\u8be5\u8d85\u8fc71;\n#SBATCH --mail-type=end\n#SBATCH --mail-user=YOU@EMAIL.COM\n#SBATCH --output=%j.out\n#SBATCH --error=%j.err\n</code></pre> <p>\u4ee5\u4e0b\u4f5c\u4e1a\u8bf7\u6c424\u5f20GPU\u5361\uff0c\u5176\u4e2d1\u4e2aCPU\u8fdb\u7a0b\u7ba1\u74061\u5f20GPU\u5361\u3002</p> <pre><code>#!/bin/bash\n#SBATCH --job-name=GPU_HPL\n#SBATCH --partition=dgx2  # \u4f5c\u4e1a\u63d0\u4ea4\u7684\u6307\u5b9a\u5206\u533a\u4e3adgx2;\n#SBATCH -n 4\n#SBATCH --ntasks-per-node=4\n#SBATCH --gres=gpu:4 # \u6bcf\u4e2a\u8282\u70b9\u4e0a\u7533\u8bf74\u5757GPU\u5361\n#SBATCH --mail-type=end\n#SBATCH --mail-user=YOU@MAIL.COM\n#SBATCH --output=%j.out\n#SBATCH --error=%j.err\n</code></pre> <p>\u4ee5\u4e0b\u4f5c\u4e1a\u542f\u52a8\u4e00\u4e2a3\u4efb\u52a1\u5e8f\u5217\uff08\u4ece0\u52302\uff09\uff0c\u6bcf\u4e2a\u4efb\u52a1\u9700\u89811\u4e2aCPU\u5185\u6838\u3002</p> <pre><code>#!/bin/bash\n#SBATCH --job-name=python_array\n#SBATCH --mail-user=YOU@MAIL.COM\n#SBATCH --mail-type=ALL\n#SBATCH --ntasks=1\n#SBATCH --time=00:30:00\n#SBATCH --array=0-2\n#SBATCH --output=python_array_%A_%a.out\n#SBATCH --output=python_array_%A_%a.err\nmodule load miniconda2/4.6.14-gcc-4.8.5\n\nsource activate YOUR_ENV_NAME\n\necho \"SLURM_JOBID: \" $SLURM_JOBID\necho \"SLURM_ARRAY_TASK_ID: \" $SLURM_ARRAY_TASK_ID\necho \"SLURM_ARRAY_JOB_ID: \" $SLURM_ARRAY_JOB_ID\npython &lt; vec_${SLURM_ARRAY_TASK_ID}.py\n</code></pre>"},{"location":"zh/system/#srun-salloc","title":"<code>srun</code> \u548c <code>salloc</code> \u4ea4\u4e92\u5f0f\u4f5c\u4e1a","text":"<p><code>srun</code> \u53ef\u4ee5\u542f\u52a8\u4ea4\u4e92\u5f0f\u4f5c\u4e1a\u3002\u8be5\u64cd\u4f5c\u5c06\u963b\u585e\uff0c\u76f4\u5230\u5b8c\u6210\u6216\u7ec8\u6b62\u3002</p> <pre><code>$ srun -N 1 -n 4 -p small hostname\ncas006\n</code></pre> <p>\u542f\u52a8\u8fdc\u7a0b\u4e3b\u673abash\u7ec8\u7aef\uff1a</p> <pre><code>srun -p small -n 4 --exclusive --pty /bin/bash\n</code></pre> <p>\u6216\u8005\uff0c\u53ef\u4ee5\u901a\u8fc7salloc\u8bf7\u6c42\u8d44\u6e90\uff0c\u7136\u540e\u5728\u83b7\u53d6\u8282\u70b9\u540e\u767b\u5f55\u5230\u8ba1\u7b97\u8282\u70b9\uff1a</p> <pre><code>salloc -N 1 -n 4 -p small\nssh casxxx\n</code></pre>"},{"location":"zh/system/#scontrol","title":"<code>scontrol</code>: \u67e5\u770b\u548c\u4fee\u6539\u4f5c\u4e1a\u53c2\u6570","text":"Slurm \u529f\u80fd <code>scontrol show job JOB_ID</code> \u67e5\u770b\u6392\u961f\u6216\u6b63\u5728\u8fd0\u884c\u7684\u4f5c\u4e1a\u7684\u4fe1\u606f <code>scontrol hold JOB_ID</code> \u6682\u505cJOB_ID <code>scontrol release JOB_ID</code> \u6062\u590dJOB_ID <code>scontrol update dependency=JOB_ID</code> \u6dfb\u52a0\u4f5c\u4e1a\u4f9d\u8d56\u6027 \uff0c\u4ee5\u4fbf\u4ec5\u5728JOB_ID\u5b8c\u6210\u540e\u624d\u5f00\u59cb\u4f5c\u4e1a <p><code>scontrol hold</code> \u547d\u4ee4\u53ef\u4f7f\u6392\u961f\u4e2d\u5c1a\u672a\u8fd0\u884c\u7684\u4f5c\u4e1a\u6682\u505c\u88ab\u5206\u914d\u8fd0\u884c\uff0c\u88ab\u6302\u8d77\u7684\u4f5c\u4e1a\u5c06\u4e0d\u88ab\u6267\u884c\u3002<code>scontrol release</code> \u547d\u4ee4\u53ef\u53d6\u6d88\u6302\u8d77\u3002</p>"},{"location":"zh/system/#sacct","title":"<code>sacct</code>\u67e5\u770b\u4f5c\u4e1a\u8bb0\u5f55","text":"Slurm \u529f\u80fd <code>sacct -l</code> \u67e5\u770b\u8be6\u7ec6\u7684\u5e10\u6237\u4f5c\u4e1a\u4fe1\u606f <code>sacct --states=R</code> \u67e5\u770b\u5177\u6709\u7279\u5b9a\u72b6\u6001\u7684\u4f5c\u4e1a\u7684\u5e10\u53f7\u4f5c\u4e1a\u4fe1\u606f <code>sacct -S YYYY-MM-DD</code> \u5728\u6307\u5b9a\u65f6\u95f4\u540e\u9009\u62e9\u5904\u4e8e\u4efb\u610f\u72b6\u6001\u7684\u4f5c\u4e1a <code>sacct --format=\u201cLAYOUT\u201d</code> \u4f7f\u7528\u7ed9\u5b9a\u7684LAYOUT\u81ea\u5b9a\u4e49sacct\u8f93\u51fa <code>sacct --help</code> \u67e5\u770b\u6240\u6709\u9009\u9879 <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>sacct</code>\u663e\u793a\u8fc7\u53bb24\u5c0f\u65f6\u7684\u5e10\u53f7\u4f5c\u4e1a\u4fe1\u606f\u3002</p> <p><code>scontrol show job</code> \u53ea\u80fd\u663e\u793a\u6b63\u5728\u8fd0\u884c\u6216\u8005\u521a\u7ed3\u675f\u6ca1\u591a\u4e45\u7684\u4f5c\u4e1a\u4fe1\u606f\uff1b\u901a\u8fc7<code>sacct</code>\u67e5\u8be2\u5df2\u7ecf\u7ed3\u675f\u4f5c\u4e1a\u7684\u76f8\u5173\u4fe1\u606f\u3002</p>"},{"location":"zh/system/#slurm_2","title":"Slurm\u73af\u5883\u53d8\u91cf","text":"\u53d8\u91cf \u63cf\u8ff0 <code>SLURM_JOB_ID</code> \u4f5c\u4e1aID <code>SLURM_JOB_NAME</code> \u4f5c\u4e1a\u540d\u79f0 <code>SLURM_JOB_PARTITION</code> \u961f\u5217\u540d\u79f0 <code>SLURM_NTASKS</code> \u8fdb\u7a0b\u603b\u6570 <code>SLURM_NTASKS_PER_NODE</code> \u6bcf\u4e2a\u8282\u70b9\u8bf7\u6c42\u7684\u4efb\u52a1\u6570 <code>SLURM_JOB_NUM_NODES</code> \u8282\u70b9\u6570 <code>SLURM_JOB_NODELIST</code> \u8282\u70b9\u5217\u8868 <code>SLURM_LOCALID</code> \u4f5c\u4e1a\u4e2d\u8fdb\u7a0b\u7684\u8282\u70b9\u672c\u5730\u4efb\u52a1ID <code>SLURM_ARRAY_TASK_ID</code> \u4f5c\u4e1a\u5e8f\u5217\u4e2d\u7684\u4efb\u52a1ID <code>SLURM_SUBMIT_DIR</code> \u5de5\u4f5c\u76ee\u5f55 <code>SLURM_SUBMIT_HOST</code> \u63d0\u4ea4\u4f5c\u4e1a\u7684\u4e3b\u673a\u540d"},{"location":"zh/system/#ansible","title":"Ansible","text":"<p>Ansible \u662f\u4e00\u6b3e\u6765\u81ea Red Hat \u7684\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\uff0c\u6b63\u5728\u8fc5\u901f\u6210DevOps \u98ce\u683c\u7cfb\u7edf\u7ba1\u7406\u7684\u6807\u51c6\u5de5\u5177\u3002Ansible \u63d0\u4f9b\u4e86\u4e00\u79cd\u58f0\u660e\u6027\u7684\u7ba1\u7406\u786c\u4ef6\u548c\u8f6f\u4ef6\u7684\u65b9\u6cd5\uff0c\u7ba1\u7406\u5458\u53ef\u4ee5\u4f7f\u7528\u4e00\u7ec4\u6613\u4e8e\u9605\u8bfb\u7684 YAML \u6587\u4ef6\u6307\u5b9a\u914d\u7f6e\u7684\u9884\u671f\u72b6\u6001\u3002\u8fd9\u4f7f\u5f97\u57fa\u7840\u67b6\u6784\u7684\u72b6\u6001\u53ef\u4ee5\u50cf\u4efb\u4f55\u5176\u4ed6\u8f6f\u4ef6\u4ee3\u7801\u4e00\u6837\u901a\u8fc7\u7248\u672c\u63a7\u5236\u548c\u53d8\u66f4\u9a8c\u8bc1\u6d41\u7a0b\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>Ansible \u4f7f\u7528\u540d\u4e3a \"\u89d2\u8272\uff08Roles\uff09\" \u7684\u6982\u5ff5\uff0c\u63d0\u4f9b\u4e00\u7ec4\u6807\u51c6\u4efb\u52a1\uff0c\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u4e00\u4e9b\u53d8\u91cf\u5728\u591a\u6b21\u6267\u884c\u6216\u591a\u4e2a\u8bbe\u5907\u4e0a\u6267\u884c\u3002</p> <p>\u4f8b\u5982\u5728\u4e0b\u56fe\u521b\u5efa\u4e09\u4e2a\u72ec\u7acb\u7684\u89d2\u8272\uff1a\u4e00\u4e2a\u7528\u4e8e A800 \u5b58\u50a8\u8bbe\u5907\uff0c\u4e00\u4e2a\u7528\u4e8eNexus \u4ea4\u6362\u673a\u7684\u7f51\u7edc\u8bbe\u5907\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7528\u4e8e DGX-1 \u670d\u52a1\u5668\u3002\u6bcf\u4e2a\u89d2\u8272\u5305\u542b\u7279\u5b9a\u8bbe\u5907\u7684\u4efb\u52a1\uff0c\u4ee5\u53ca\u5b8c\u6210\u914d\u7f6e\u6240\u9700\u7684\u9ed8\u8ba4\u53d8\u91cf\u6216\u5176\u4ed6\u6587\u4ef6\u3002</p> <p> </p> ONTAP AI solution verified architecture"}]}